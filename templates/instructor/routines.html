<!DOCTYPE html>
<html>
<head>
    <title>Quản lý bài võ</title>
</head>
<body>
    <h1>QUẢN LÝ BÀI VÕ</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div><strong>[{{ category|upper }}]</strong> {{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <p><a href="{{ url_for('instructor.create_routine') }}">+ Tạo bài võ mới</a></p>

    <form method="GET">
        <label>Cấp độ:</label>
        <select name="level" onchange="this.form.submit()">
            <option value="">Tất cả</option>
            <option value="beginner" {{ 'selected' if request.args.get('level') == 'beginner' }}>Sơ cấp</option>
            <option value="intermediate" {{ 'selected' if request.args.get('level') == 'intermediate' }}>Trung cấp</option>
            <option value="advanced" {{ 'selected' if request.args.get('level') == 'advanced' }}>Nâng cao</option>
        </select>

        <label>Binh khí:</label>
        <select name="weapon_id" onchange="this.form.submit()">
            <option value="">Tất cả</option>
            {% for w in weapons %}
            <option value="{{ w.weapon_id }}" {{ 'selected' if request.args.get('weapon_id')|int == w.weapon_id }}>{{ w.weapon_name_vi }}</option>
            {% endfor %}
        </select>

        <label>Trạng thái:</label>
        <select name="status" onchange="this.form.submit()">
            <option value="">Tất cả</option>
            <option value="draft" {{ 'selected' if request.args.get('status') == 'draft' }}>Nháp</option>
            <option value="published" {{ 'selected' if request.args.get('status') == 'published' }}>Đã xuất bản</option>
        </select>
    </form>

    {% if routines %}
        {% for r in routines %}
        <div>
            <h3>
                {{ r.routine_name }}
                <span>{{ 'Đã xuất bản' if r.is_published else 'Nháp' }}</span>
            </h3>
            <p>
                <strong>Mã:</strong> {{ r.routine_code }} |
                <strong>Binh khí:</strong> {{ r.weapon.weapon_name_vi }} |
                <strong>Cấp độ:</strong> {{ r.level }} |
                <strong>Thời lượng:</strong> {{ r.duration_seconds }}s |
                <strong>Độ khó:</strong> {{ r.difficulty_score }}/10<br>
                <strong>Ngưỡng đạt:</strong> {{ r.pass_threshold }}% |
                <strong>Số động tác:</strong> {{ r.total_moves }}
            </p>
            <p>
                <a href="{{ url_for('instructor.routine_detail', routine_id=r.routine_id) }}">Chi tiết</a> |
                <a href="{{ url_for('instructor.edit_routine', routine_id=r.routine_id) }}">Sửa</a>
            </p>
        </div>
        {% endfor %}
    {% else %}
        <p>Chưa có bài võ nào. <a href="{{ url_for('instructor.create_routine') }}">Tạo bài võ đầu tiên</a></p>
    {% endif %}

    <hr>
    <p><a href="{{ url_for('instructor.dashboard') }}">Về Dashboard</a></p>
</body>
</html>

