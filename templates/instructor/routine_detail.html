<!DOCTYPE html>
<html>
<head>
    <title>Chi ti·∫øt b√†i v√µ</title>
</head>
<body>
    <h1>CHI TI·∫æT B√ÄI V√ï</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div><strong>[{{ category|upper }}]</strong> {{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <table>
        <tr><td>Tr·∫°ng th√°i</td><td><strong>{{ 'ƒê√£ xu·∫•t b·∫£n' if routine.is_published else 'Nh√°p' }}</strong></td></tr>
        <tr><td>M√£ b√†i v√µ</td><td><strong>{{ routine.routine_code }}</strong></td></tr>
        <tr><td>T√™n b√†i v√µ</td><td><strong>{{ routine.routine_name }}</strong></td></tr>
        <tr><td>M√¥ t·∫£</td><td>{{ routine.description or 'Kh√¥ng c√≥' }}</td></tr>
        <tr><td>Binh kh√≠</td><td>{{ routine.weapon.weapon_name_vi }} ({{ routine.weapon.weapon_name_en }})</td></tr>
        <tr><td>C·∫•p ƒë·ªô</td><td>{{ routine.level }}</td></tr>
        <tr><td>ƒê·ªô kh√≥</td><td>{{ routine.difficulty_score }}/10</td></tr>
        <tr><td>Th·ªùi l∆∞·ª£ng</td><td>{{ routine.duration_seconds }} gi√¢y ({{ (routine.duration_seconds / 60)|round(1) }} ph√∫t)</td></tr>
        <tr><td>S·ªë ƒë·ªông t√°c</td><td>{{ routine.total_moves }}</td></tr>
        <tr><td>Ng∆∞·ª°ng ƒë·∫°t</td><td>{{ routine.pass_threshold }}%</td></tr>
        <tr><td>Video m·∫´u</td><td>{% if routine.reference_video_url %}<a href="{{ routine.reference_video_url }}" target="_blank">Xem video</a>{% else %}Ch∆∞a c√≥{% endif %}</td></tr>
        <tr><td>Ng√†y t·∫°o</td><td>{{ routine.created_at.strftime('%d/%m/%Y %H:%M') }}</td></tr>
        <tr><td>C·∫≠p nh·∫≠t l·∫ßn cu·ªëi</td><td>{{ routine.updated_at.strftime('%d/%m/%Y %H:%M') }}</td></tr>
    </table>

    {% if routine.reference_video_url %}
    <div class="video-container">
        <h2>üé• VIDEO M·∫™U CHU·∫®N</h2>
        
        {% if routine.reference_video_url.startswith('/static') %}
            <!-- Video upload l√™n server -->
            <video width="640" height="360" controls>
                <source src="{{ routine.reference_video_url }}" type="video/mp4">
                Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ video
            </video>
        {% else %}
            <!-- Video t·ª´ URL b√™n ngo√†i -->
            <p>
                <a href="{{ routine.reference_video_url }}" target="_blank" 
                   style="padding:10px 20px; background:#dc3545; color:white; 
                          text-decoration:none; border-radius:4px;">
                    ‚ñ∂Ô∏è Xem video m·∫´u
                </a>
            </p>
        {% endif %}
    </div>
    {% endif %}

    <h2>TI√äU CH√ç ƒê√ÅNH GI√Å (T·ªïng: {{ total_weight }}%)</h2>
    <p><a href="{{ url_for('instructor.add_criteria', routine_id=routine.routine_id) }}">+ Th√™m ti√™u ch√≠</a></p>

    {% if criteria %}
        {% for c in criteria %}
        <div>
            <strong>{{ c.criteria_name }}</strong> ({{ c.criteria_code }}) - <strong>{{ c.weight_percentage }}%</strong>
            {% if c.description %}<br><small>{{ c.description }}</small>{% endif %}
            {% if c.evaluation_method %}<br><small>Ph∆∞∆°ng ph√°p: {{ c.evaluation_method }}</small>{% endif %}
            <form method="POST" action="{{ url_for('instructor.delete_criteria', criteria_id=c.criteria_id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" onclick="return confirm('X√°c nh·∫≠n x√≥a?')">X√≥a</button>
            </form>
        </div>
        {% endfor %}
        {% if total_weight < 100 %}
        <p>T·ªïng tr·ªçng s·ªë ch∆∞a ƒë·ªß 100% (c√≤n {{ 100 - total_weight }}%)</p>
        {% elif total_weight > 100 %}
        <p>T·ªïng tr·ªçng s·ªë v∆∞·ª£t qu√° 100%!</p>
        {% else %}
        <p>T·ªïng tr·ªçng s·ªë h·ª£p l·ªá (100%)</p>
        {% endif %}
    {% else %}
        <p>Ch∆∞a c√≥ ti√™u ch√≠ ƒë√°nh gi√° n√†o</p>
    {% endif %}

    <h2>THAO T√ÅC</h2>
    <p>
        <a href="{{ url_for('instructor.edit_routine', routine_id=routine.routine_id) }}">S·ª≠a b√†i v√µ</a>
        {% if routine.is_published %}
            <form method="POST" action="{{ url_for('instructor.unpublish_routine', routine_id=routine.routine_id) }}" style="display:inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit">G·ª° xu·∫•t b·∫£n</button>
            </form>
        {% else %}
            <form method="POST" action="{{ url_for('instructor.publish_routine', routine_id=routine.routine_id) }}" style="display:inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit">Xu·∫•t b·∫£n</button>
            </form>
        {% endif %}
        <form method="POST" action="{{ url_for('instructor.delete_routine', routine_id=routine.routine_id) }}" style="display:inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" onclick="return confirm('X√°c nh·∫≠n x√≥a b√†i v√µ?')">X√≥a</button>
        </form>
    </p>

    <hr>
    <p><a href="{{ url_for('instructor.routines') }}">V·ªÅ danh s√°ch</a></p>
</body>
</html>

