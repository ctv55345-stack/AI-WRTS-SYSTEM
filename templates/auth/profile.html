{% extends "base/base.html" %}

{% block title %}Thông tin cá nhân - AI-WRTS System{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/auth.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-avatar-wrapper">
                <div class="profile-avatar">
                    {% set display_name = user.full_name or user.username %}
                    {% if user.avatar_url %}
                        <img src="{{ user.avatar_url }}" alt="{{ display_name }}">
                    {% else %}
                        {{ (display_name|default('U'))[0]|upper }}
                    {% endif %}
                </div>
            </div>
            
            <h1 class="profile-name">{{ display_name }}</h1>
            
            <div class="profile-role">
                {% if user.role.role_code == 'STUDENT' %}
                    <i class="fas fa-user-graduate"></i>
                    <span>Học viên</span>
                {% elif user.role.role_code == 'INSTRUCTOR' %}
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span>Huấn luyện viên</span>
                {% elif user.role.role_code == 'ADMIN' %}
                    <i class="fas fa-user-shield"></i>
                    <span>Quản trị viên</span>
                {% elif user.role.role_code == 'MANAGER' %}
                    <i class="fas fa-user-tie"></i>
                    <span>Ban quản lý</span>
                {% endif %}
            </div>
        </div>
        
        <div class="profile-body">
            <div class="profile-section">
                <h3 class="profile-section-title">
                    <i class="fas fa-user"></i>
                    Thông tin cá nhân
                </h3>
                
                <div class="profile-info-grid">
                    <div class="profile-info-item">
                        <span class="profile-info-label">Username</span>
                        <span class="profile-info-value">{{ user.username }}</span>
                    </div>
                    
                    <div class="profile-info-item">
                        <span class="profile-info-label">Email</span>
                        <span class="profile-info-value">{{ user.email }}</span>
                    </div>
                    
                    <div class="profile-info-item">
                        <span class="profile-info-label">Số điện thoại</span>
                        <span class="profile-info-value {% if not user.phone %}empty{% endif %}">
                            {{ user.phone if user.phone else 'Chưa cập nhật' }}
                        </span>
                    </div>
                    
                    <div class="profile-info-item">
                        <span class="profile-info-label">Ngày sinh</span>
                        <span class="profile-info-value {% if not user.date_of_birth %}empty{% endif %}">
                            {{ user.date_of_birth.strftime('%d/%m/%Y') if user.date_of_birth else 'Chưa cập nhật' }}
                        </span>
                    </div>
                    
                    <div class="profile-info-item">
                        <span class="profile-info-label">Giới tính</span>
                        <span class="profile-info-value {% if not user.gender %}empty{% endif %}">
                            {% if user.gender == 'male' %}
                                Nam
                            {% elif user.gender == 'female' %}
                                Nữ
                            {% elif user.gender == 'other' %}
                                Khác
                            {% else %}
                                Chưa cập nhật
                            {% endif %}
                        </span>
                    </div>
                    
                    <div class="profile-info-item">
                        <span class="profile-info-label">Địa chỉ</span>
                        <span class="profile-info-value {% if not user.address %}empty{% endif %}">
                            {{ user.address if user.address else 'Chưa cập nhật' }}
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="profile-section">
                <h3 class="profile-section-title">
                    <i class="fas fa-info-circle"></i>
                    Thông tin tài khoản
                </h3>
                
                <div class="profile-info-grid">
                    <div class="profile-info-item">
                        <span class="profile-info-label">Vai trò</span>
                        <span class="profile-info-value">{{ user.role.role_name }}</span>
                    </div>
                    
                    <div class="profile-info-item">
                        <span class="profile-info-label">Trạng thái</span>
                        <span class="profile-info-value">
                            {% if user.is_active %}
                                <span class="badge bg-success">Hoạt động</span>
                            {% else %}
                                <span class="badge bg-danger">Tạm dừng</span>
                            {% endif %}
                        </span>
                    </div>
                    
                    <div class="profile-info-item">
                        <span class="profile-info-label">Email đã xác thực</span>
                        <span class="profile-info-value">
                            {% if user.is_email_verified %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check"></i> Đã xác thực
                                </span>
                            {% else %}
                                <span class="badge bg-warning">
                                    <i class="fas fa-exclamation"></i> Chưa xác thực
                                </span>
                            {% endif %}
                        </span>
                    </div>
                    
                    <div class="profile-info-item">
                        <span class="profile-info-label">Ngày tạo tài khoản</span>
                        <span class="profile-info-value">
                            {{ user.created_at.strftime('%d/%m/%Y %H:%M') }}
                        </span>
                    </div>
                    
                    <div class="profile-info-item">
                        <span class="profile-info-label">Cập nhật lần cuối</span>
                        <span class="profile-info-value">
                            {{ user.updated_at.strftime('%d/%m/%Y %H:%M') }}
                        </span>
                    </div>
                    
                    <div class="profile-info-item">
                        <span class="profile-info-label">Đăng nhập lần cuối</span>
                        <span class="profile-info-value">
                            {{ user.last_login_at.strftime('%d/%m/%Y %H:%M') if user.last_login_at else 'Chưa có dữ liệu' }}
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="profile-actions">
                <a href="{{ url_for('auth.edit_profile') }}" class="profile-action-btn primary">
                    <i class="fas fa-edit"></i>
                    <span>Chỉnh sửa thông tin</span>
                </a>
                
                <a href="{{ url_for('auth.change_password') }}" class="profile-action-btn secondary">
                    <i class="fas fa-key"></i>
                    <span>Đổi mật khẩu</span>
                </a>
                
                {% if session.role_code == 'STUDENT' %}
                    <a href="{{ url_for('student.dashboard') }}" class="profile-action-btn secondary">
                        <i class="fas fa-arrow-left"></i>
                        <span>Về Dashboard</span>
                    </a>
                {% elif session.role_code == 'INSTRUCTOR' %}
                    <a href="{{ url_for('instructor.dashboard') }}" class="profile-action-btn secondary">
                        <i class="fas fa-arrow-left"></i>
                        <span>Về Dashboard</span>
                    </a>
                {% elif session.role_code == 'ADMIN' %}
                    <a href="{{ url_for('admin.dashboard') }}" class="profile-action-btn secondary">
                        <i class="fas fa-arrow-left"></i>
                        <span>Về Dashboard</span>
                    </a>
                {% elif session.role_code == 'MANAGER' %}
                    <a href="{{ url_for('manager.dashboard') }}" class="profile-action-btn secondary">
                        <i class="fas fa-arrow-left"></i>
                        <span>Về Dashboard</span>
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/auth.js') }}"></script>
{% endblock %}