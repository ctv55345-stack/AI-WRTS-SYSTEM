<!DOCTYPE html>
<html>
<head>
    <title>Ph√¢n t√≠ch h·ªçc t·∫≠p</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        .stat-box { 
            display: inline-block; 
            border: 1px solid #ddd; 
            padding: 20px; 
            margin: 10px; 
            width: 200px;
            text-align: center;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .stat-box h3 { margin: 0 0 10px 0; color: #333; font-size: 14px; }
        .stat-box p { margin: 0; font-size: 28px; font-weight: bold; color: #4CAF50; }
        .chart-container { 
            margin: 20px 0; 
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .chart-wrapper { 
            position: relative; 
            height: 400px; 
            margin: 20px auto;
        }
        .progress-bar-container {
            background: #eee;
            height: 30px;
            width: 100%;
            border-radius: 15px;
            overflow: hidden;
        }
        .progress-bar-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üìä PH√ÇN T√çCH H·ªåC T·∫¨P</h1>
    
    <h2>T·ªïng quan</h2>
    <div class="stat-box">
        <h3>T·ªïng video</h3>
        <p>{{ overview.total_videos }}</p>
    </div>
    <div class="stat-box">
        <h3>ƒêi·ªÉm TB (AI)</h3>
        <p>{{ overview.avg_ai_score }}</p>
    </div>
    <div class="stat-box">
        <h3>ƒêi·ªÉm TB (GV)</h3>
        <p>{{ overview.avg_manual_score }}</p>
    </div>
    <div class="stat-box">
        <h3>T·ª∑ l·ªá ƒë·∫°t</h3>
        <p>{{ overview.pass_rate }}%</p>
    </div>
    
    <!-- LINE CHART: Score Progression -->
    <div class="chart-container">
        <h2>üìà Ti·∫øn ƒë·ªô ƒëi·ªÉm s·ªë (30 ng√†y g·∫ßn nh·∫•t)</h2>
        <div class="chart-wrapper">
            <canvas id="scoreProgressionChart"></canvas>
        </div>
    </div>
    
    <!-- DOUGHNUT CHART: Completion Rate -->
    <div class="chart-container">
        <h2>üéØ Ho√†n th√†nh b√†i v√µ</h2>
        <p>ƒê√£ ho√†n th√†nh: <strong>{{ completion.completed }}/{{ completion.total_routines }}</strong> ({{ completion.completion_rate }}%)</p>
        <div class="chart-wrapper" style="height: 300px;">
            <canvas id="completionChart"></canvas>
        </div>
    </div>
    
    <!-- RADAR CHART: Strengths & Weaknesses -->
    <div class="chart-container">
        <h2>‚öîÔ∏è ƒêi·ªÉm m·∫°nh/y·∫øu</h2>
        <div class="chart-wrapper">
            <canvas id="radarChart"></canvas>
        </div>
    </div>
    
    <p><a href="{{ url_for('student.dashboard') }}">‚Üê V·ªÅ Dashboard</a></p>
    
    <script>
        // 1. LINE CHART - Score Progression
        const scoreData = {{ score_data | tojson }};
        
        const dates = scoreData.map(item => item.date);
        const aiScores = scoreData.map(item => item.ai_score);
        const manualScores = scoreData.map(item => item.manual_score);
        
        const ctxLine = document.getElementById('scoreProgressionChart').getContext('2d');
        new Chart(ctxLine, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    {
                        label: 'ƒêi·ªÉm AI',
                        data: aiScores,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'ƒêi·ªÉm Gi·∫£ng vi√™n',
                        data: manualScores,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'ƒêi·ªÉm s·ªë'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Ng√†y'
                        }
                    }
                }
            }
        });
        
        // 2. DOUGHNUT CHART - Completion Rate
        const ctxDoughnut = document.getElementById('completionChart').getContext('2d');
        new Chart(ctxDoughnut, {
            type: 'doughnut',
            data: {
                labels: ['ƒê√£ ho√†n th√†nh', 'Ch∆∞a ho√†n th√†nh'],
                datasets: [{
                    data: [{{ completion.completed }}, {{ completion.total_routines - completion.completed }}],
                    backgroundColor: [
                        'rgb(76, 175, 80)',
                        'rgb(220, 220, 220)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        
        // 3. RADAR CHART - Strengths & Weaknesses
        const ctxRadar = document.getElementById('radarChart').getContext('2d');
        new Chart(ctxRadar, {
            type: 'radar',
            data: {
                labels: ['K·ªπ thu·∫≠t', 'T∆∞ th·∫ø', 'Nh·ªãp ƒëi·ªáu'],
                datasets: [{
                    label: 'ƒêi·ªÉm s·ªë c·ªßa b·∫°n',
                    data: [
                        {{ strengths.technique }},
                        {{ strengths.posture }},
                        {{ strengths.timing }}
                    ],
                    fill: true,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgb(54, 162, 235)',
                    pointBackgroundColor: 'rgb(54, 162, 235)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgb(54, 162, 235)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            stepSize: 20
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    </script>
</body>
</html>
