{% extends 'base/student_base.html' %}

{% block title %}N·ªôp B√†i T·∫≠p - {{ assignment.routine.routine_name }}{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/student.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1">
                <i class="fas fa-paper-plane text-primary me-2"></i>
                N·ªôp B√†i T·∫≠p
            </h1>
            <p class="text-muted mb-0">T·∫£i l√™n video ƒë·ªÉ n·ªôp b√†i cho b√†i t·∫≠p</p>
        </div>
        <a href="{{ url_for('student.my_assignments') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Quay l·∫°i
        </a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ 'success' if category == 'success' else ('danger' if category == 'error' else category) }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-0 py-3">
            <h5 class="mb-0"><i class="fas fa-info-circle text-info me-2"></i>Th√¥ng tin b√†i t·∫≠p</h5>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-6">
                    <div><strong>B√†i v√µ:</strong> {{ assignment.routine.routine_name }}</div>
                    <div><strong>M√£ b√†i:</strong> {{ assignment.routine.routine_code }}</div>
                </div>
                <div class="col-md-6">
                    <div><strong>H·∫°n n·ªôp:</strong> <span class="text-danger fw-semibold">{{ assignment.deadline.strftime('%d/%m/%Y %H:%M') }}</span></div>
                </div>
                {% if assignment.instructions %}
                <div class="col-12">
                    <div class="alert alert-info mb-0">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>H∆∞·ªõng d·∫´n:</strong> {{ assignment.instructions }}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Video Demo c·ªßa Assignment -->
    {% if assignment.instructor_video_url %}
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-0 py-3">
            <h5 class="mb-0">
                <i class="fas fa-video text-success me-2"></i>
                Video Demo - Tham kh·∫£o
            </h5>
        </div>
        <div class="card-body">
            <div class="alert alert-info mb-3">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Video demo:</strong> Xem video n√†y ƒë·ªÉ hi·ªÉu c√°ch th·ª±c hi·ªán b√†i t·∫≠p ƒë√∫ng c√°ch.
            </div>
            <div class="ratio ratio-16x9 bg-black rounded">
                <video controls class="w-100 h-100">
                    <source src="{{ assignment.instructor_video_url }}" type="video/mp4">
                    <p class="text-white text-center p-3">Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ video ho·∫∑c file kh√¥ng t·ªìn t·∫°i</p>
                </video>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 py-3">
            <h5 class="mb-0"><i class="fas fa-file-video text-primary me-2"></i>Bi·ªÉu m·∫´u n·ªôp b√†i</h5>
        </div>
        <div class="card-body">
            <form method="POST" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="mb-3">
                    <label for="video_file" class="form-label">üìπ Ch·ªçn file video *</label>
                    <input type="file" id="video_file" name="video_file" accept="video/mp4,video/avi,video/mov,video/x-matroska" class="form-control" required>
                    <div class="form-text">ƒê·ªãnh d·∫°ng: mp4, avi, mov, mkv | T·ªëi ƒëa: 500MB</div>
                </div>

                <div class="mb-3">
                    <label for="notes" class="form-label">üìù Ghi ch√∫ (t√πy ch·ªçn)</label>
                    <textarea id="notes" name="notes" rows="4" class="form-control" placeholder="VD: T·∫≠p ·ªü nh√†, ch∆∞a thu·ªôc h·∫øt ƒë·ªông t√°c..."></textarea>
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check me-2"></i>N·ªôp B√†i
                    </button>
                    <a href="{{ url_for('student.my_assignments') }}" class="btn btn-light">H·ªßy</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/student.js') }}"></script>
{% endblock %}
